<br>
<br>
<div id="list" class="container">
<div class="row text-center">
	<div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3">
		<input type="search" id="container-search" value="" class="form-control" placeholder="想喝什麼？"></input>
	</div>
</div>
<br>
<div id="container"></div>
</div>
<div id="detail" class="container">
	<div class="row text-center">
		<div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3">
			<h2 id="productname"></h2>
			<img id="productimg" class="well"></img>
			<h1 id="productprice" class="text-danger"></h1>
		</div>
	</div>
</div>
<script type="text/x-handlebars-template" id="waterfall-tpl">
{{#result}}
	<div class="item" style="width:222px;">
		<a style="display:block" href="#productlist&{{p_id}}" onclick="loadproductdetail({{p_id}})"></a>
		<img style="width:192px;" alt="{{p_name}}" src="{{pic_path}}" />
		<h5 class="text-center productname" style="width:192px;">{{p_name}}</h5>
	</div>
{{/result}}
</script>

<!-- <div class="item" style="width:222px;">
		<h5 class="text-center productname">{{p_id}}</h5>
</div> -->

<!-- {{#photos}}
    {{#photo}}
    <div class="item" style="width:222px;">
        <img style="width:192px;" height="{{height}}" alt="{{title}}" src="http://farm{{farm}}.static.flickr.com/{{server}}/{{id}}_{{secret}}_m.jpg" />
		<h6 class="text-center productname" style="width:192px;">{{title}}</h6>
	</div>
    {{/photo}}
{{/photos}} -->
<script src="js/waterfall.js"></script>
<script>
$('#container').waterfall({
    itemCls: 'item',
    colWidth: 222,  
    gutterWidth: 15,
    gutterHeight: 15,
	maxPage: 1,
	isFadeIn: true,
	path: function( page ) {
        return 'http://www.meigic.tw/oase/go.php';
    },
	params: {
		'type': 'productlist'
	},
	dataType: "json",
	
	/*
    path: function( page ) {
        return 'http://api.flickr.com/services/rest/?page=' +page+ '&jsoncallback=?';
    },
    dataType: "jsonp",
    jsonpCallback: "jsoncallback",
    params: {
        'method': 'flickr.photos.search',
        'api_key': 'f290d9d56bd82fde0c87d7fd6a0e6c33',
        'tags': 'travel',
        'per_page': 20,
        'format': 'json'
    },
	*/
	
	callbacks: {
		loadingFinished: function($loading, isBeyondMaxPage) {
			$( '#container' ).searchable({
				searchField: '#container-search',
				selector: '.item',
				childSelector: '.productname',
				show: function( elem ) {
					//elem.slideDown(100);
					elem.removeClass("hidden").addClass("item");
				},
				hide: function( elem ) {
					//elem.slideUp( 100 );
					elem.removeClass("item").addClass("hidden").addClass("temp");
				},
				searchType    : 'default',
				onSearchActive : function( elem, term ) {
					//elem.show();
					$('#container').waterfall('reLayout');
				},
				onSearchEmpty: function( elem ) {
					//elem.hide();
					$(".temp").addClass("item").removeClass("hidden").removeClass("temp");
					$('#container').waterfall('reLayout');
				},
				onSearchFocus: function() {
					//$('#container').waterfall('reLayout');
				},
				onSearchBlur: function() {
					//$('#container').waterfall('reLayout');
				},
				onSearchComplete: function(elem, term) {
					$('#container').waterfall('reLayout');
				},
				clearOnLoad: true,
			});
			if ( !isBeyondMaxPage ) {
                $loading.fadeOut();
            } else {
                $loading.hide();
                $('#page-navigation').show();
            }
		},
		loadingError: function($message, xhr) {
			$message.html(xhr + " " + xhr.status + " " + xhr.statusText);
		}
	}
});
function loadelse() {
	//console.log("loadelse");
	if(currentpara[0] == "productlist") {
		if(currentpara.length > 1) {
			var id = currentpara[1];
			//console.log(id);
			if(id != '' || id != undefined) {
				showdetail();
				loadproductdetail(id);
			} else {
				showlist();
			}
		} else {
			showlist();
		}
	}
}
function showlist() {
	$( '#list' ).show( "blind", { direction: "left" });
	$( '#detail' ).hide( "blind", { direction: "left" });
}
function showdetail() {
	$( '#list' ).hide( "blind", { direction: "left" });
	$( '#detail' ).show( "blind", { direction: "left" });
}
function loadproductdetail(pid) {
	$.getJSON("http://www.meigic.tw/oase/go.php", {type:"productlist", id: pid}, function(data) {
		//alert(data.result[0].p_name);
		$( "#detail #productname" ).html(data.result[0].p_name);
		$( "#detail #productimg" ).attr("src", data.result[0].pic_path);
		$( "#detail #productprice" ).html("$" + data.result[0].price);
	});
}
$('body').css('overflow-x','hidden');
</script>