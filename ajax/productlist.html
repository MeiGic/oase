<br>
<div id="list" class="container">
<br>
<div class="row text-center">
	<div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3">
		<input type="search" id="container-search" value="" class="form-control" placeholder="想喝什麼？"></input>
	</div>
</div>
<br>
<div id="container"></div>
</div>
<div id="detail" class="container">
	<div class="row text-center">
		<div class="col-lg-4 col-lg-offset-2 col-md-4 col-md-offset-2">
			<br>
			<img id="productimg" class="img-rounded well" style="width:100%; max-width:400px;"></img>
		</div>
		<div class="col-lg-4 col-md-4">
			<h1 id="productname"></h1>
			<br>
			<form role="form">
				<div class="btn-group-vertical" data-toggle="buttons">
				  <label class="btn btn-success active">
					<input type="radio" name="size" id="large"> 大杯
				  </label>
				  <label class="btn btn-success">
					<input type="radio" name="size" id="medium"> 中杯
				  </label>
				  <label class="btn btn-success">
					<input type="radio" name="size" id="small"> 小杯
				  </label>
				</div>
				<div class="btn-group-vertical" data-toggle="buttons">
				  <label class="btn btn-warning active">
					<input type="radio" name="sweet" id="full"> 全糖
				  </label>
				  <label class="btn btn-warning">
					<input type="radio" name="sweet" id="less"> 少糖
				  </label>
				  <label class="btn btn-warning">
					<input type="radio" name="sweet" id="half"> 半糖
				  </label>
				  <label class="btn btn-warning">
					<input type="radio" name="sweet" id="few"> 微糖
				  </label>
				  <label class="btn btn-warning">
					<input type="radio" name="sweet" id="none"> 無糖
				  </label>
				</div>
				<div class="btn-group-vertical" data-toggle="buttons">
				  <label class="btn btn-primary active">
					<input type="radio" name="temp" id="full" class="active"> 全冰
				  </label>
				  <label class="btn btn-primary">
					<input type="radio" name="temp" id="less"> 少冰
				  </label>
				  <label class="btn btn-primary">
					<input type="radio" name="temp" id="half"> 半冰
				  </label>
				  <label class="btn btn-primary">
					<input type="radio" name="temp" id="few"> 微冰
				  </label>
				  <label class="btn btn-primary">
					<input type="radio" name="temp" id="none"> 去冰
				  </label>
				</div>
				<br>
				<br>
				<input type="text" id="count" class="form-control" />
				<h2 id="productprice" class="text-danger"></h2>
				<button type="button" class="btn btn-lg btn-danger"><i class="fa fa-thumbs-o-up"></i> 購買</button>
			</form>
		</div>
	</div>
</div>
<script type="text/x-handlebars-template" id="waterfall-tpl">
{{#result}}
	<div class="item" style="width:222px;">
		<a style="display:block" href="#productlist&{{p_id}}" onclick="loadproductdetail({{p_id}})"></a>
		<img style="width:192px;" alt="{{p_name}}" src="{{pic_path}}" />
		<h5 class="text-center productname" style="width:192px;">{{p_name}}</h5>
	</div>
{{/result}}
</script>

<!-- <div class="item" style="width:222px;">
		<h5 class="text-center productname">{{p_id}}</h5>
</div> -->

<!-- {{#photos}}
    {{#photo}}
    <div class="item" style="width:222px;">
        <img style="width:192px;" height="{{height}}" alt="{{title}}" src="http://farm{{farm}}.static.flickr.com/{{server}}/{{id}}_{{secret}}_m.jpg" />
		<h6 class="text-center productname" style="width:192px;">{{title}}</h6>
	</div>
    {{/photo}}
{{/photos}} -->
<script src="js/waterfall.js"></script>
<script>
$('#container').waterfall({
    itemCls: 'item',
    colWidth: 222,  
    gutterWidth: 15,
    gutterHeight: 15,
	maxPage: 1,
	isFadeIn: true,
	path: function( page ) {
        return 'http://www.meigic.tw/oase/go.php';
    },
	params: {
		'type': 'productlist'
	},
	dataType: "json",
	
	/*
    path: function( page ) {
        return 'http://api.flickr.com/services/rest/?page=' +page+ '&jsoncallback=?';
    },
    dataType: "jsonp",
    jsonpCallback: "jsoncallback",
    params: {
        'method': 'flickr.photos.search',
        'api_key': 'f290d9d56bd82fde0c87d7fd6a0e6c33',
        'tags': 'travel',
        'per_page': 20,
        'format': 'json'
    },
	*/
	
	callbacks: {
		loadingFinished: function($loading, isBeyondMaxPage) {
			$( '#container' ).searchable({
				searchField: '#container-search',
				selector: '.item',
				childSelector: '.productname',
				show: function( elem ) {
					//elem.slideDown(100);
					elem.removeClass("hidden").addClass("item");
				},
				hide: function( elem ) {
					//elem.slideUp( 100 );
					elem.removeClass("item").addClass("hidden").addClass("temp");
				},
				searchType    : 'default',
				onSearchActive : function( elem, term ) {
					//elem.show();
					$('#container').waterfall('reLayout');
				},
				onSearchEmpty: function( elem ) {
					//elem.hide();
					$(".temp").addClass("item").removeClass("hidden").removeClass("temp");
					$('#container').waterfall('reLayout');
				},
				onSearchFocus: function() {
					//$('#container').waterfall('reLayout');
				},
				onSearchBlur: function() {
					//$('#container').waterfall('reLayout');
				},
				onSearchComplete: function(elem, term) {
					$('#container').waterfall('reLayout');
				},
				clearOnLoad: true,
			});
			if ( !isBeyondMaxPage ) {
                $loading.fadeOut();
            } else {
                $loading.hide();
                $('#page-navigation').show();
            }
		},
		loadingError: function($message, xhr) {
			$message.html(xhr + " " + xhr.status + " " + xhr.statusText);
		}
	}
});
function loadelse() {
	//console.log("loadelse");
	if(currentpara[0] == "productlist" && currentpara.length > 1) {
		var id = currentpara[1];
		//console.log(id);
		if(id != '' || id != undefined) {
			showdetail();
			loadproductdetail(id);
		} else {
			showlist();
		}
	} else {
		showlist();
	}
}
function showlist() {
	$( '#list' ).removeClass('hidden');
	$( '#list' ).show( "blind", { direction: "left" }, "fast");
	$( '#detail' ).addClass('hidden');
	$( '#detail' ).hide( "blind", { direction: "left" }, "fast");
	$('#container').waterfall('reLayout');
}
function showdetail() {
	$( '#list' ).addClass('hidden');
	$( '#list' ).hide( "blind", { direction: "left" }, "fast");
	$( '#detail' ).removeClass('hidden');
	$( '#detail' ).show( "blind", { direction: "left" }, "fast");
}
function loadproductdetail(pid) {
	$( "#detail #productimg" ).hide();
	$.getJSON("http://www.meigic.tw/oase/go.php", {type:"productlist", id: pid}, function(data) {
		//alert(data.result[0].p_name);
		$( "#detail #productname" ).html(data.result[0].p_name);
		$( "#detail #productimg" ).attr("src", data.result[0].pic_path);
		$( "#detail #productprice" ).html("NTD$ " + data.result[0].price);
		$( "#detail #productimg" ).fadeIn();
	});
}
$(function () {
	$('body').css('overflow-x','hidden');
	$('#count').spinedit({
		minimum: 1,
		maximum: 99,
		step: 1
	});
});
</script>